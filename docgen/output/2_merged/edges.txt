# Edges

# Edges

Edges define directed connections between two nodes, forming the pathways of a Jac graph. They are first-class citizens, meaning they can have their own attributes and abilities, allowing for rich, complex relationship modeling.

## Edge Archetype

The `edge` keyword defines an edge archetype.

```jac
edge Friend {}
```

In Library Mode, edges inherit from `jaclang.lib.Edge`:

```python
from jaclang.lib import Edge

class Friend(Edge):
    pass
```

`GenericEdge` is the default edge type when no specific type is specified.

## Edge Declaration and Attributes

Edges can have attributes defined using the `has` keyword, similar to nodes.

```jac
edge InClass {
    has room: str;
}

edge StudyGroup {
    has subject: str;
}

edge FriendsWith {
    has since: str;
    has closeness: int = 5; # 1-10 scale
    has strength: int = 1;  # Relationship strength for weighted algorithms
}

edge ParentOf {}

edge ConnectedTo {
    has strength: int;
}

edge EnrolledIn {
    has enrollment_date: str;
    has grade: str = "Not Assigned";
    has attendance_rate: float = 100.0;
}

edge Teaches {
    has start_date: str;
    has schedule: str;  # "MWF 9:00-10:00"
    has is_primary: bool = True;
}
```

## Edge Creation Operators

Edges connect nodes within the graph. The `++>` operator adds a node to the graph by connecting it to an existing node.

### Basic Connections

-   `++>`: Unidirectional forward edge.
-   `<++`: Unidirectional backward edge.
-   `<++>`: Bidirectional edge.

```jac
with entry {
    node_a = Node(name="A");
    node_b = Node(name="B");

    root ++> node_a;  // Add node_a to the root graph
    node_a ++> node_b;  // Connect node_a to node_b

    node_1 ++> node_2; // uni directional edge
    node_1 <++> node_2; // bidirectional edge
}
```

### Typed Connections

Edges can be typed, providing additional meaning and allowing attributes to be set during creation.

-   `+>:EdgeType(attributes):+>`: Unidirectional forward typed edge.
-   `<+:EdgeType(attributes):+>`: Unidirectional backward typed edge.
-   `<+:EdgeType(attributes):+>`: Bidirectional typed edge.

```jac
edge Friend {
    has since: int;
}

edge custom1 {
    has atrib1:str;
}

with entry {
    a +>:Friend(since=2020):+> b;
    a +>:Friend(since=1995):+> c;

    node_1 +:custom1:atrib1='val1':+> node_2; // uni directional edge
    node_1 <+:custom1:atrib1='val2':+> node_2; // bidirectional edge

    science_lab = root ++> Classroom(
        room_number="Lab-A",
        capacity=24,
        has_projector=True
    );

    dr_smith = science_lab +>:Teaches(
        start_date="2024-08-01",
        schedule="TR 10:00-11:30"
    ):+> Teacher(
        name="Dr. Smith",
        subject="Chemistry",
        years_experience=12,
        email="smith@school.edu"
    );
}
```

## Edge Deletion

The `del` keyword can be used to delete an edge between two nodes.

```jac
node_1 del --> node_2;
```

## Edge Traversal and Queries

Walkers use edge selectors to navigate the graph.

### Traversal Operators

-   `[-->]`: Follow all outgoing edges from the current node.
-   `[<--]`: Follow all incoming edges to the current node.
-   `[-->-->]`: Follow two consecutive outgoing edges.
-   `[->:EdgeType->]`: Follow only edges of a specific `EdgeType`.
-   `[edge -->]`: Returns edge objects instead of connected nodes.

```jac
walker PathWalker {
    has input: str;

    can start with `root entry {
        visit [-->];
    }

    can visit_node  with Node entry{
        self.input += ", visiting " + here.name;
        visit [here-->];
    }

    can visit_end with EndNode entry {
        self.input += ", reached the end";
        return;
    }
}
```

### Edge Queries

Edges can be queried with filters based on their type and attributes.

-   `[node a ->:Friend:since > 2018:->]`: Returns all outgoing nodes connected by `Friend` edges where `since` is greater than 2018.
-   `[edge a->:Friend:since > 2017:->]`: Returns all outgoing `Friend` edges where `since` is greater than 2017.

## Edge Abilities

An `entry` ability triggers when a walker arrives at an edge. An `exit` ability triggers when a walker leaves an edge. Specialized entry abilities can trigger for specific edge types.

When walkers visit edges explicitly using `visit [edge -->]`, abilities are executed on both the edge and its connected node.

## Spawning Walkers on Edges

Walkers can be spawned on a list of nodes and edges, enabling traversal across multiple graph elements simultaneously. Spawning a walker on an edge automatically queues both the edge and its target node for processing.

## Edge Serialization

Jac Cloud automatically serializes edge archetypes into a JSON format:

```json
{
    "id": "unique_anchor_reference_id",
    "context": {
        "attribute1": "value1",
        "attribute2": "value2"
    }
}
```

## Custom Access Validation

`Edge` archetypes can override the `__jac_access__` reserved function to implement custom access validation logic.

## `visitor` Keyword

The `visitor` keyword references the walker context within nodes/edges. `here` is used only in walker abilities to reference the current node/edge.

# Edges

Edges create relationships between nodes, allowing agentic workflows to be formally defined. Edges represent relationships, dependencies, or hierarchies between agents.

## Edge Declaration

Edges can be generic (default) or custom, defined with specific properties.

```jac
edge Follow {}
```

Custom edges allow defining specific properties and behaviors for relationships between nodes.

```jac
edge edge_name{
    has edge_property: int = 10;
}
```

## Edge Creation

### Unidirectional and Bidirectional Edges

```jac
node_1 ++> node_2; # uni directional edge
node_1 <++> node_2; # bidirectional edge
```

### Custom Edges

```jac
node_1 +: edge_name :+> node_2;
node_1 +: edge_name :edge_property= 15: +> node_2; # connect with specific property value
```

### Connecting Nodes to Lists of Nodes

Nodes can be connected to a list of nodes in series (one after the other) or in parallel (all at once).

```jac
# Series connection (one after the other)
node_1 ++> node_list[0];
for i to i < length(node_list) by i+=1 {
    node_list[i] ++> node_list[i+1];
}

# Parallel connection (all at once)
node_1 ++> node_list;
```

### Mesh Connections

A mesh connection between two lists of nodes connects each node in the first list to each node in the second list.

```jac
node_list_1 ++> node_list_2;
```

### Example: Agentic Workflow Edges

For example, a `TaskHandling` node might have edges pointing to `Task` nodes it created.

```jac
node Task {
  has task:str = "";
  has date:str = "";
  has time:str = "";
}

node TaskHandling {
  def get_current_time() -> str {
    return time.strftime("%Y-%m-%d %H:%M:%S", time.gmtime());
  }

  def add_task(task: str, date: str, time: str) -> str {
    task_created = Task(task=task, date=date, time=time);
    self ++> task_created;
    return "Task added successfully";
  }

  def summarize_tasks -> str {
    scheduled_tasks = [self-->(`?Task)];
    return str(scheduled_tasks);
  }

  def route_and_run(utterance: str) -> str by llm(
    method="ReAct",
    tools=([self.add_task, self.get_current_time, self.summarize_tasks])
  );

  can execute with task_manager entry {
    print("[TaskHandling Node Activated]");
    response = self.route_and_run(visitor.cur_task.task);
    print("â†’", response);
    report {
      "utterance": visitor.cur_task.task,
      "response": response,
      "node_type": self.__class__.__name__
    };
  }
}
```

## Edge Deletion

To delete a connection between nodes:

```jac
node_1 del --> node_2;
```

## Edge Filtering and Traversal

JacLang provides flexible filtering mechanisms to control graph traversal and operations, allowing precise selection of nodes and edges based on specific criteria.

### Retrieving Edges

You can retrieve all edges connected to a node or between two nodes using edge filtering expressions.

```jac
print([edge node_a-->]);
print([edge node_a<--]);
print([edge node_list[0]-->]);
print([edge node_1-->node_2]);
print([edge node_list[0]-->node_list[1]]);
```

### Edge-Based Filtering

Edge filtering allows developers to control traversal by selecting edges based on specific attributes or conditions.

```jac
--8<-- "jac/examples/data_spatial/edge_filtering.jac"
```

### Walker Control Movement

Use `visit` to walk along an edge connecting nodes.

### Traversal Parameters

When traversing, `edge_types` can be used to filter results by edge type.

| Name         | Type     | Description                                                                                                                                                                              | Default Value       |
| :----------- | :------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------ |
| `edge_types` | `string` | Can be declared multiple times to filter the traversal results by edge type. For example, `edge_types=Edge1&edge_types=Edge2` will include only edges that are `Edge1` or `Edge2` types. | All edge types      |

## Edge Representation in JSON

Edges are represented in JSON with `id`, `source`, and `target` fields.

```json
{
  "edges": [
    {
      "id": "e::68875f483d1e672f517096a5",
      "source": "n::68875f383d1e672f517094ff",
      "target": "n:A:68875f483d1e672f517096a0"
    },
    {
      "id": "e::68875f483d1e672f517096a2",
      "source": "n:A:68875f483d1e672f517096a0",
      "target": "n:B:68875f483d1e672f517096a1"
    },
    {
      "id": "e::68875f483d1e672f517096a4",
      "source": "n:B:68875f483d1e672f517096a1",
      "target": "n:C:68875f483d1e672f517096a3"
    }
  ]
}
```

During traversal, edges can be returned in steps:

```json
{"nodes": [], "edges": [{"id": "e::step1_edge1", "source": "n::start_node", "target": "n::next_node_A"}]}
{"nodes": [{"id": "n::next_node_A", "edges": ["e::step1_edge1"]}], "edges": []}
{"nodes": [], "edges": [{"id": "e::step2_edge1", "source": "n::next_node_A", "target": "n::final_node_B"}]}
{"nodes": [{"id": "n::final_node_B", "edges": ["e::step2_edge1"]}], "edges": []}
```