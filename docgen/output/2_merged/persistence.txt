# Persistence and Storage

## Persistence and Storage

### Saving and Loading Data

The `save` and `load` operations are fundamental for persisting and retrieving data within the system.

-   **`save`**: Serializes and stores the current state of an object or graph.
-   **`load`**: Deserializes and reconstructs an object or graph from stored data.

```jac
# Saving a node
node_to_save = node::create("MyNode", {"data": "some_value"});
save node_to_save;

# Loading a node
loaded_node = load node::id("MyNode");

# Saving a graph
graph_to_save = graph::create("MyGraph");
# ... add nodes and edges to graph_to_save ...
save graph_to_save;

# Loading a graph
loaded_graph = load graph::id("MyGraph");
```

### File I/O

Module: `file`

Provides functions for interacting with the file system.

-   `file.open(path: str, mode: str = "r") -> File`: Opens a file at the specified `path` with the given `mode`.
    -   `mode`: "r" (read), "w" (write, truncates), "a" (append), "b" (binary).
-   `file.read(file_obj: File, size: int = -1) -> str | bytes`: Reads `size` bytes/characters from `file_obj`. If `size` is -1, reads the entire file.
-   `file.write(file_obj: File, data: str | bytes) -> int`: Writes `data` to `file_obj`. Returns the number of bytes/characters written.
-   `file.close(file_obj: File)`: Closes the `file_obj`.

```jac
# Writing to a file
with file.open("my_file.txt", "w") as f:
    file.write(f, "Hello, Jac!\n");
    file.write(f, "This is a test.");

# Reading from a file
with file.open("my_file.txt", "r") as f:
    content = file.read(f);
    print(content);

# Appending to a file
with file.open("my_file.txt", "a") as f:
    file.write(f, "\nAppending more data.");
```

### Operating System Interaction

Module: `os`

Provides functions for interacting with the operating system.

-   `os.getcwd() -> str`: Returns the current working directory.
-   `os.chdir(path: str)`: Changes the current working directory to `path`.
-   `os.listdir(path: str = ".") -> list[str]`: Returns a list of entries in the directory `path`.
-   `os.mkdir(path: str)`: Creates a directory named `path`.
-   `os.remove(path: str)`: Removes the file `path`.
-   `os.rmdir(path: str)`: Removes the empty directory `path`.
-   `os.path.exists(path: str) -> bool`: Returns `True` if `path` refers to an existing path or an open file descriptor.
-   `os.path.join(path1: str, path2: str, ...) -> str`: Joins one or more path components intelligently.

```jac
# Get current working directory
current_dir = os.getcwd();
print(str "Current directory: {current_dir}");

# Create a new directory
if not os.path.exists("my_data"):
    os.mkdir("my_data");

# List directory contents
files = os.listdir(".");
print(str "Files in current directory: {files}");
```

### JSON Serialization

Module: `json`

Provides functions for working with JSON data.

-   `json.dumps(obj: any, indent: int = None) -> str`: Serializes `obj` to a JSON formatted `str`.
    -   `indent`: If provided, pretty-prints JSON with the specified indent level.
-   `json.loads(json_str: str) -> any`: Deserializes `json_str` (a JSON formatted `str`) to a Jac object.

```jac
import:py from json {dumps, loads};

# Serialize a dictionary to JSON string
data = {"name": "Alice", "age": 30, "isStudent": false};
json_string = dumps(data, indent=2);
print(json_string);

# Deserialize a JSON string to a Jac object
parsed_data = loads(json_string);
print(parsed_data.name); # Accessing deserialized data
```

### Logging

Module: `logging`

Provides a flexible framework for emitting log messages.

-   `logging.debug(message: str)`: Logs a message with level `DEBUG`.
-   `logging.info(message: str)`: Logs a message with level `INFO`.
-   `logging.warning(message: str)`: Logs a message with level `WARNING`.
-   `logging.error(message: str)`: Logs a message with level `ERROR`.
-   `logging.critical(message: str)`: Logs a message with level `CRITICAL`.
-   `logging.basicConfig(level: int = logging.INFO, format: str = '%(levelname)s:%(name)s:%(message)s')`: Configures the logging system.
    -   `level`: Sets the threshold for logging. Common levels: `logging.DEBUG`, `logging.INFO`, `logging.WARNING`, `logging.ERROR`, `logging.CRITICAL`.
    -   `format`: Specifies the log message format.

```jac
import:py from logging {basicConfig, INFO, DEBUG, warning, info, debug};

# Configure basic logging
basicConfig(level=INFO, format='%(asctime)s - %(levelname)s - %(message)s');

# Log messages
info("This is an informational message.");
warning("This is a warning message.");
debug("This message will not be shown by default (level is INFO).");

# Change log level to DEBUG
basicConfig(level=DEBUG);
debug("This message will now be shown.");
```