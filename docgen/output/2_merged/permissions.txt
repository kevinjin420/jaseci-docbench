# Permissions and Security

```
## Permissions and Security

### Access Control

Permissions define who can access what resources and what actions they can perform.

#### `can` Keyword
The `can` keyword is used to define permissions within a scope.

```jac
can read: node;
can write: edge;
```

#### `has` Keyword
The `has` keyword is used to check for permissions.

```jac
node has read: node;
```

#### `grant` and `revoke`
Permissions can be granted or revoked dynamically.

```jac
grant read: node to user_id;
revoke write: edge from group_id;
```

### Security Context

The security context determines the current user's permissions.

#### `with` Keyword
The `with` keyword can be used to temporarily change the security context.

```jac
with user_id:
    # Actions performed here will use user_id's permissions
    node.read();
```

### Standard Library Interactions

#### File I/O
Module: `file`
- `open(path: str, mode: str = "r") -> File`: Opens a file. `mode` can be "r" (read), "w" (write), "a" (append), "x" (create new), "b" (binary).
- `read(file_obj: File, size: int = -1) -> str | bytes`: Reads from an open file. `size` specifies the number of bytes/characters to read.
- `write(file_obj: File, data: str | bytes) -> int`: Writes data to an open file. Returns the number of bytes/characters written.
- `close(file_obj: File)`: Closes an open file.

```jac
import:py from file {open, read, write, close};

with file.open("my_file.txt", "w") as f:
    file.write(f, "Hello, world!");

with file.open("my_file.txt", "r") as f:
    content = file.read(f);
    print(content);
```

#### Operating System Interaction
Module: `os`
- `getenv(key: str) -> str | None`: Returns the value of the environment variable `key`, or `None` if not set.
- `setenv(key: str, value: str)`: Sets the environment variable `key` to `value`.
- `remove(path: str)`: Removes (deletes) the file or empty directory at `path`.
- `mkdir(path: str)`: Creates a directory at `path`.
- `rmdir(path: str)`: Removes an empty directory at `path`.
- `listdir(path: str) -> list[str]`: Returns a list containing the names of the entries in the directory given by `path`.

```jac
import:py from os {getenv, setenv, remove};

var my_env_var = os.getenv("MY_VARIABLE");
if my_env_var is None:
    os.setenv("MY_VARIABLE", "some_value");
    print("MY_VARIABLE set.");
else:
    print(str "MY_VARIABLE is: " + my_env_var);
```

#### JSON Serialization
Module: `json`
- `dumps(obj: any, indent: int | None = None) -> str`: Serializes `obj` to a JSON formatted `str`. `indent` can be used for pretty-printing.
- `loads(s: str) -> any`: Deserializes a JSON formatted `str` to a Python object.

```jac
import:py from json {dumps, loads};

var my_data = {"name": "Alice", "age": 30};
var json_string = json.dumps(my_data, indent=2);
print(json_string);

var loaded_data = json.loads(json_string);
print(loaded_data.name);
```

#### Logging
Module: `logging`
- `basicConfig(level: int = logging.INFO, format: str = '%(levelname)s:%(name)s:%(message)s')`: Configures the logging system. `level` can be `logging.DEBUG`, `logging.INFO`, `logging.WARNING`, `logging.ERROR`, `logging.CRITICAL`.
- `debug(msg: str, *args)`: Logs a message with level `DEBUG`.
- `info(msg: str, *args)`: Logs a message with level `INFO`.
- `warning(msg: str, *args)`: Logs a message with level `WARNING`.
- `error(msg: str, *args)`: Logs a message with level `ERROR`.
- `critical(msg: str, *args)`: Logs a message with level `CRITICAL`.

```jac
import:py from logging {basicConfig, info, warning, error, DEBUG, INFO};

logging.basicConfig(level=logging.INFO);
logging.info("This is an informational message.");
logging.warning("This is a warning message.");
logging.error("This is an error message.");
```

### Imports
- `import:py` for Python interop.

```jac
import:py from some_module {some_function};
```

### Spawning
- `spawn` creates new agents or processes.

```jac
spawn my_agent;
spawn my_agent on nodes;
spawn my_agent on [node1, node2];
```

### Type Annotations
- `has x: type` for explicit type annotations.

```jac
node Person {
    has name: str;
    has age: int;
}
```

### Reference Operator
- `&` for creating references.

```jac
var my_ref = &my_node;
```

### Node Properties
- `.edges` accesses edges connected to a node.

```jac
for edge in my_node.edges:
    print(edge);
```

### Semantic Strings
- `str "..."` for semantic string literals.

```jac
var greeting = str "Hello, world!";
```

### Asynchronous Operations
- `async`, `await` for asynchronous programming.

```jac
async def fetch_data(url: str) -> str:
    # ...
    return await some_async_call(url);

async {
    var data = await fetch_data("http://example.com");
    print(data);
}
```

### Assertions
- `assert` for testing and validation.

```jac
assert 1 == 1, "One should equal one";
```

### Persistence
- `save`, `load` for data persistence.

```jac
save my_data to "data.json";
var loaded_data = load "data.json";
```

### Agent Loops
- `while` with `by llm()` for agent interaction loops.

```jac
agent MyAgent {
    can chat;
    state {
        var conversation: list[str] = [];
    }
    
    with entry {
        while True:
            var user_input = by llm();
            conversation.append(str "User: " + user_input);
            
            // Process input, generate response
            var agent_response = "I received: " + user_input;
            conversation.append(str "Agent: " + agent_response);
            
            print(agent_response);
            if user_input == "quit":
                break;
    }
}
```
```